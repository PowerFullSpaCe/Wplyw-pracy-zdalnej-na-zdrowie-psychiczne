---
title: "Wp≈Çyw pracy zdalnej na dobrostan psychiczny cz≈Çowieka"
author: "Diana Morzhak"
lang: pl
format: 
  html:
    theme: cosmo
    code-styling: grid # Wymusza t≈Ço i ramkƒô dla kodu
    code-overflow: wrap   # Zapewnia, ≈ºe kod nie wychodzi poza ramkƒô
    toc: true
    toc-title: "Spis tre≈õci"
    toc-depth: 2
    toc-location: left
    number-sections: false
editor: visual
execute: 
  echo: false
  warning: false
---

# Wstƒôp

![Wyobra≈∫my sobie, ≈ºe jeste≈õmy przedsiƒôbiorcami szukajƒÖcymi najlepszych rozwiƒÖza≈Ñ](images/2e271064572b26f8e790bc68353fcaa2.jpg)

## Problem badawczy

Pandemia COVID-19 przyczyni≈Ça siƒô do radykalnej zmiany w sposobie wykonywania pracy, powodujƒÖc globalny wzrost popularno≈õci pracy zdalnej i hybrydowej. Choƒá ten model pracy zapewnia wiƒôkszƒÖ elastyczno≈õƒá, jego wp≈Çyw na zdrowie psychiczne i samopoczucie pracownik√≥w budzi coraz wiƒôksze zainteresowanie badaczy oraz praktyk√≥w. Praca zdalna niesie za sobƒÖ zar√≥wno korzy≈õci, jak i wyzwania ‚Äì od ograniczenia czasu spƒôdzanego na dojazdach, po poczucie izolacji spo≈Çecznej i trudno≈õci w zachowaniu r√≥wnowagi miƒôdzy ≈ºyciem zawodowym a prywatnym. Niniejszy projekt podejmuje pr√≥bƒô zrozumienia, w jakim stopniu te czynniki kszta≈ÇtujƒÖ dobrostan psychiczny pracownik√≥w. Celem jest zatem udzielenie odpowiedzi na pytanie "Jaki jest wp≈Çyw pracy zdalnej oraz jej uwarunkowa≈Ñ na zdrowie i samopoczucie psychiczne cz≈Çowieka?".

![Nie chcemy, aby nasi pracownicy tak siƒô czuli, wiƒôc nale≈ºy przebadaƒá kwestiƒô zdrowia psychicznego!](images/Follow%20me%20on%20instagram_%20huongg_thu14_Thank%20you%20üíï.jpg)

Aby obszernie przeanalizowaƒá problem, rozpatrywaƒá bƒôdziemy nastƒôpujƒÖce pytania badawcze:

-   czy z≈Çe samopoczucie psychiczne w zwiƒÖzku z wykonywanƒÖ pracƒÖ zdalnƒÖ zale≈ºy od rodzaju wykonywanego zawodu lub wieku pracownika?

-   jakie sƒÖ r√≥≈ºnice w samopoczuciu psychicznym pracownik√≥w zdalnych w zale≈ºno≈õci od ich p≈Çci?

-   w jakim stopniu r√≥≈ºni siƒô poziom stresu, poczucie izolacji spo≈Çecznej oraz og√≥lny stan psychiczny pracownik√≥w zdalnych w por√≥wnaniu do pracownik√≥w stacjonarnych?

-   czy poziom stresu, poczucie izolacji spo≈Çecznej oraz og√≥lny stan psychiczny pracownik√≥w stacjonarnych, hybrydowych oraz zdalnych r√≥≈ºni siƒô w zale≈ºno≈õci od zamieszkiwanego kontynentu?

-   czy wp≈Çyw pracy hybrydowej jest mniej szkodliwy dla zdrowia psychicznego cz≈Çowieka ni≈º wp≈Çyw pracy zdalnej?

-   czy tryb wykonywanej pracy mo≈ºe mieƒá wp≈Çyw na jako≈õƒá snu pracownik√≥w?

-   w jakim stopniu wsparcie oferowane przez pracodawcƒô zmniejsza negatywne skutki pracy zdalnej?

-   czy liczba przepracowanych godzin tygodniowo ma znaczenie w kontek≈õcie zdrowia psychicznego w pracy zdalnej?

## Charakterystyka zbioru danych

Zbi√≥r danych nosi nazwƒô "Impact of Remote Work on Mental Health" i pochodzi z patformy Kaggle od u≈ºytkownika waqi786 [^1].\
Zbi√≥r sk≈Çada siƒô z 20 kolumn oraz 5000 wierszy. Wed≈Çug informacji podanych przez autora zbioru, dane by≈Çy zebrane od r√≥≈ºnych pracownik√≥w z r√≥≈ºnych czƒô≈õci ≈õwiata.

[^1]: Link do zbioru danych (niestety ju≈º nieaktywny): <https://www.kaggle.com/datasets/waqi786/remote-work-and-mental-health>

### Opis poszczeg√≥lnych zmiennych:

1.  `Employee_ID` - identyfikator osoby (unikalny dla ka≈ºdej).
2.  `Age` - Wiek osoby.
3.  `Gender` - P≈Çeƒá osoby.
4.  `Job_Role` - Rola osoby w pracy.
5.  `Industry` - Bran≈ºa, w kt√≥rej pracuje osoba.
6.  `Work_Location` - Lokalizacja pracy osoby.
7.  `Hours_Worked_Per_Week` - Liczba przepracowanych godzin tygodniowo.
8.  `Number_of_Virtual_Meetings` - Liczba wirtualnych spotka≈Ñ tygodniowo.
9.  `Work_Life_Balance_Rating` - Ocena r√≥wnowagi miƒôdzy ≈ºyciem zawodowym a prywatnym.
10. `Stress_Level` - Poziom stresu zwiƒÖzanego z pracƒÖ.
11. `Mental_Health_Condition` - Og√≥lna ocena stanu zdrowia psychicznego osoby.
12. `Access_to_Mental_Health_Resources` - Dostƒôp do zasob√≥w zdrowia psychicznego oferowanych przez firmƒô.
13. `Productivity_Change` - Zmiana produktywno≈õci w por√≥wnaniu do pracy stacjonarnej.
14. `Social_Isolation_Rating` - Ocena poczucia izolacji spo≈Çecznej spowodowanego pracƒÖ zdalnƒÖ.
15. `Satisfaction_with_Remote_Work` - Poziom zadowolenia z pracy zdalnej.
16. `Company_Support_for_Remote_Work` - Wsparcie firmy dla pracy zdalnej.
17. `Physical_Activity` - Poziom aktywno≈õci fizycznej osoby.
18. `Sleep_Quality` - Wp≈Çyw pracy zdalnej na jako≈õƒá snu.
19. `Region` - Region zamieszkania osoby.

Zobaczmy, jak wyglƒÖda struktura zbioru danych:

```{r}
library(dplyr)
```

```{r}
data <- read.csv("Impact_of_Remote_Work_on_Mental_Health.csv")
data <- data %>% 
  select(-Years_of_Experience, -Industry, -Employee_ID)

```

```{r echo=TRUE, include=FALSE}
# za≈ÇƒÖczamy biblioteki
library(DT)
str(data)
```

```{r include = FALSE}
summary(data)
```

```{r}
# z wykorzystaniem biblioteki DT
datatable(head(data))
```

\

Sprawd≈∫my, czy nasz zbi√≥r zawiera brakujƒÖce warto≈õci:

```{r}
cat("Liczba brakujƒÖcych warto≈õci:", sum(is.na(data)), "\n")
```

Zatem zbi√≥r sk≈Çada siƒô z kolumn typu "char" oraz "int" i nie zawiera on danych brakujƒÖcych. Mo≈ºemy zatem przej≈õƒá do jego przygotowania do analizy i wizualizacji.

# Przetwarzanie danych. Selekcja cech

Zajmiemy siƒô dostosowaniem typ√≥w danych w ramce do potrzeb analizy i wykonania wizualizacji. W tym celu najpierw sprawdzimy unikalne warto≈õci w ka≈ºdej z kolumn, aby zapoznaƒá siƒô ze zmiennymi, kt√≥re poddamy kategoryzacji:

```{r}
cat("Warto≈õci unikalne dla zmiennej:
     \n Work_Location: ", unique(data$Work_Location),
    "\n Work_Life_Balance_Rating: ", unique(data$Work_Life_Balance_Rating),
    "\n Stress_Level: ", unique(data$Stress_Level), 
    "\n Access_to_Mental_Health_Resources: ", unique(data$Access_to_Mental_Health_Resources),
    "\n Productivity_Change: ", unique(data$Productivity_Change),
    "\n Social_Isolation_Rating: ", unique(data$Social_Isolation_Rating),
    "\n Satisfaction_with_Remote_Work: ", unique(data$Satisfaction_with_Remote_Work),
    "\n Company_Support_for_Remote_Work: ", unique(data$Company_Support_for_Remote_Work),
    "\n Physical_Activity: ", unique(data$Physical_Activity),
    "\n Sleep_Quality: ", unique(data$Sleep_Quality),
    "\n Region: ", unique(data$Region))
```

```{r}
# Kategoryzacja zmiennych:
data <- data %>% 
  mutate( Work_Location = factor(Work_Location),
          Work_Life_Balance_Rating = factor(Work_Life_Balance_Rating),
          Stress_Level = factor(Stress_Level),
          Access_to_Mental_Health_Resources = factor(Access_to_Mental_Health_Resources),
          Productivity_Change = factor(Productivity_Change),
          Social_Isolation_Rating = factor(Social_Isolation_Rating),
          Satisfaction_with_Remote_Work = factor(Satisfaction_with_Remote_Work),
          Company_Support_for_Remote_Work = factor(Company_Support_for_Remote_Work),
          Physical_Activity = factor(Physical_Activity),
          Sleep_Quality = factor(Sleep_Quality),
          Region = factor(Region),
          Gender = factor(Gender),
          Job_Role = factor(Job_Role),
          Mental_Health_Condition = factor(Mental_Health_Condition))
```

```{r}
# Usuniƒôcie duplikat√≥w:
data <- data %>% 
  distinct(.keep_all = TRUE)
```

Szukamy warto≈õci odstajƒÖcych (zastosowanie biblioteki ggstatsplot i funkcji ggbetweenstats do boxplot√≥w):

```{r echo=TRUE,include = FALSE}
library(extrafont)
loadfonts(device = "win")
library(ggplot2)
library(ggstatsplot)
```

```{r}

# zastosowanie pakiet√≥w ggplot2 i ggstatsplot
ggbetweenstats(data, x = Gender, y = Age,fill = Gender, outlier.tagging = TRUE)+
  theme(
    text = element_text(family = "Century Gothic", size = 8, color = "black"),
    plot.title = element_text(
      family = "Century Gothic", 
      size = 20,
      face = "bold",
      color = "#2a475e"),
      # Statistical annotations below the main title
    plot.subtitle = element_text(
      family = "Century Gothic", 
      size = 10, 
      face = "bold",
      color="#1b2838"
    ),
    plot.title.position = "plot", # slightly different from default
    axis.text = element_text(size = 10, color = "black"),
    axis.title = element_text(size = 12),
    axis.ticks = element_blank(),
    axis.line = element_line(colour = "grey50"),
    panel.grid = element_line(color = "#b4aea9"),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(linetype = "dashed"),
    panel.background = element_rect(fill = "#ffffff", color = "#ffffff"),
    plot.background = element_rect(fill = "#ffffff", color = "#ffffff")
  )+
  labs(
    x = "P≈Çeƒá",
    y = "Wiek",
    title = "Rozk≈Çad wieku w zale≈ºno≈õci od p≈Çci"
  )
```

```{r}
ggbetweenstats(
  data = data, 
  x = Gender, 
  y = Hours_Worked_Per_Week,
  fill = Gender,
  outlier.tagging = TRUE
) +
  scale_color_manual(values = c(
    "Female" = "#d462ff", 
    "Male" = "#62e0ff", 
    "Non-binary" = "#ffa35c", 
    "Prefer not to say" = "#5eff7e"
  )) +
  theme(
    text = element_text(family = "Century Gothic", size = 8),
    plot.title = element_text(
      family = "Century Gothic", 
      size = 12,
      face = "bold",
      color = "#2a475e"
    ),
    plot.subtitle = element_text(
      family = "Century Gothic", 
      size = 10, 
      face = "bold",
      color="#1b2838"
    ),
    plot.title.position = "plot",
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 10),
    axis.ticks = element_blank(),
    axis.line = element_line(colour = "grey50"),
    panel.grid = element_line(color = "#b4aea9"),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(linetype = "dashed"),
    panel.background = element_rect(fill = "#ffffff", color = "#ffffff"),
    plot.background = element_rect(fill = "#ffffff", color = "#ffffff")
  ) +
  labs(
    x = "P≈Çeƒá",
    y = "Liczba godzin pracy w jednym tygodniu",
    title = "Rozk≈Çad godzin pracy na tydzie≈Ñ w zale≈ºno≈õci od p≈Çci"
  )
```

Widzimy go≈Çym okiem, ≈ºe zbi√≥r r√≥wnie≈º nie posiada warto≈õci odstajƒÖcych. Po obliczeniach rƒôcznych wyniki wyglƒÖdajƒÖ tak samo. Dane w zale≈ºno≈õci od p≈Çci sƒÖ do≈õƒá r√≥wnomiernie roz≈Ço≈ºone. Sprawdzimy, czy dalsza analiza odkryje co≈õ ciekawego.\

```{r}

Q1 <- quantile(data$Hours_Worked_Per_Week, .25)
Q3 <- quantile(data$Hours_Worked_Per_Week, .75)
IQR <- IQR(data$Hours_Worked_Per_Week)


outliers <- subset(data, data$Hours_Worked_Per_Week<(Q1 - 1.5*IQR) | data$Hours_Worked_Per_Week>(Q3 + 1.5*IQR))

Q1_1 <- quantile(data$Age, .25)
Q3_1 <- quantile(data$Age, .75)
IQR_1 <- IQR(data$Age)


outliers1 <- subset(data, data$Age<(Q1 - 1.5*IQR) | data$Age>(Q3 + 1.5*IQR))


```

Natomiast w tym momencie zbi√≥r danych jest przygotowany do dalszego wykorzystania.

# Analiza

W tej czƒô≈õci umieszczone zostanƒÖ wizualizacje oraz wnioski, jakie mo≈ºemy wykonaƒá na ich podstawie.

## Korelacje

### Pomiƒôdzy zmiennymi kategorycznymi

ZwiƒÖzki pomiƒôdzy zmiennymi kategorycznymi zbadamy za pomocƒÖ testu chi-kwadrat. Warto≈õci p-value dla ka≈ºdej pary zmiennych kategorycznych zapiszemy w macierzy `p_value_matrix`. HipotezƒÖ zerowƒÖ jest stwierdzenie, ≈ºe pomiƒôdzy dwoma zmiennymi nie zachodzi ≈ºaden zwiƒÖzek. Poziomem istotno≈õci jest og√≥lnoprzyjƒôta warto≈õƒá $\alpha = 0.05$, co oznacza, ≈ºe je≈ºeli warto≈õƒá p-value bƒôdzie mniejsza od poziomu istotno≈õci, to odrzucamy hipotezƒô zerowƒÖ.

```{r}
# ramka danych dla zmiennych kategorycznych
data_categorical <-  data %>% 
  select( -Age, -Hours_Worked_Per_Week, -Number_of_Virtual_Meetings, -Job_Role)
```

```{r}
# Inicjalizacja pustej macierzy dla p-values
n <- ncol(data_categorical)
p_value_matrix <- matrix(NA, nrow = n, ncol = n)
colnames(p_value_matrix) <- rownames(p_value_matrix) <- colnames(data_categorical)

# Obliczanie p-value dla ka≈ºdej pary zmiennych
for (i in 1:n) {
  for (j in 1:n) {
    if (i != j) {  # Pomijamy testy zmiennej ze sobƒÖ samƒÖ
      # Tworzenie tabeli kontyngencji
      contingency_table <- table(data_categorical[[i]], data_categorical[[j]])
      
      # Test chi-kwadrat
      test_result <- chisq.test(contingency_table, simulate.p.value = FALSE)
      
      # Zapis p-value
      p_value_matrix[i, j] <- test_result$p.value
    } else {
      p_value_matrix[i, j] <- NA  # Brak p-value dla zmiennej ze sobƒÖ samƒÖ
    }
  }
}
```

```{r echo=TRUE,include = FALSE}
library(heatmaply)
library(RColorBrewer)
```

\
Wykorzystujemy bibliotekƒô `heatmaply` do stworzenia interaktywnej mapy cieplnej:

```{r}
#zastosowanie pakiet√≥w heatmaply i RColorBrewer
# Tworzenie heatmapy dla p-values
heatmaply(p_value_matrix,
        dendrogram = "none",
        xlab = "", ylab = "",
        main = "P-values dla testu chi-kwadrat",
        scale = "none",
        margins = c(60,100,40,20),
        grid_color = "white",
        grid_width = 0.00001,
        titleX = FALSE,
        hide_colorbar = FALSE,
        branches_lwd = 0.1,
        fontsize_row = 5, fontsize_col = 5,
        labCol = colnames(p_value_matrix),
        labRow = rownames(p_value_matrix),
        heatmap_layers = theme(axis.line = element_blank()),
        colors = colorRampPalette(brewer.pal(9, "YlGnBu"))(100) # Paleta YlGnBu
        )

```

Zgodnie z naszymi za≈Ço≈ºeniami mo≈ºemy stwierdziƒá (z pewno≈õciƒÖ 95%), ≈ºe istnieje zwiƒÖzek pomiƒôdzy nastƒôpujƒÖcymi parami zmiennych:

-   `Access_to_Mental_Health_Resources` z `Stress_Level` , `Productivity_Change`

-   `Physical_Avtivity` z `Gender` , `Social_Isolation_Rating`

-   `Sleep_Quality` i `Productivity_Change`

Opr√≥cz powy≈ºszych, mo≈ºna r√≥wnie≈º zwr√≥ciƒá uwagƒô na zwiƒÖzek `Stress_Level` i `Social_Isolation_Rating` .

Natomiast nic nie wiemy o sile tego zwiƒÖzku. Do zbadania tego zastosujemy miarƒô V-Cramera. W tym celu, podobnie jak w poprzednim kroku, stworzymy macierz uzyskanych warto≈õci, a na jej podstawie zwizualizujemy wyniki:

```{r echo=TRUE,include = FALSE}
library(vcd) # Do obliczenia miary V-Cramera
library(ggplot2)
library(hrbrthemes)
library(plotly)
library(reshape2)
```

```{r}
# Funkcja obliczajƒÖca miarƒô V-Cramera
calculate_cramers_v <- function(x, y) {
  tbl <- table(x, y)
  assocstats(tbl)$cramer
}

# Inicjalizacja pustej macierzy
n <- ncol(data_categorical)
cramers_v_matrix <- matrix(NA, nrow = n, ncol = n)
colnames(cramers_v_matrix) <- rownames(cramers_v_matrix) <- colnames(data_categorical)

# wype≈Çniamy macierz uzyskanymi warto≈õciami
for (i in 1:n) {
  for (j in 1:n) {
    if (i != j) {
      cramers_v_matrix[i, j] <- calculate_cramers_v(data_categorical[[i]], data_categorical[[j]])
    } else {
      cramers_v_matrix[i, j] <- NA  # Brak warto≈õci dla zmiennej ze sobƒÖ samƒÖ
    }
  }
}
```

```{r}
# Zamiana macierzy na ramkƒô danych
cramers_v_df <- melt(cramers_v_matrix, na.rm = TRUE)
colnames(cramers_v_df) <- c("Variable1", "Variable2", "CramersV")
```

\

Do zbudowania wykresu cieplnego wykorzystamy bibliotekƒô `ggplot2`. Na jego podstawie tworzymy interaktywny wykres za pomocƒÖ biblioteki `plotly` z wykorzystaniem funkcji `ggplotly`:

```{r}
# Statyczny wykres cieplny z niestandardowƒÖ skalƒÖ kolor√≥w
heatmap_plot <- ggplot(cramers_v_df, aes(x = Variable1, y = Variable2, fill = CramersV)) +
  geom_tile(color = "white") +  # Kom√≥rki z bia≈Çymi liniami
  scale_fill_gradientn(
    colors = c("white", "lavender", "orchid", "purple"),
    values = c(0, 0.1, 0.3, 0.5) / 0.5,            # Normalizacja do przedzia≈Çu [0, 1]
    limits = c(0, 0.5),                            # Zakres warto≈õci
    na.value = "grey"                              # Kolor dla NA
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 6),  # Rotacja etykiet osi X
    axis.text.y = element_text(size = 6),
    panel.grid = element_blank()                        # Usuniƒôcie siatki
  ) +
  labs(
    title = "Wykres warto≈õci miary V-Cramera",
    x="",
    y="",
    fill = "Miara V-Cramera"
  )

ggplotly(heatmap_plot, tooltip = c("x", "y", "fill"))
```

W tym przypadku r√≥wnie≈º rozpatrujemy og√≥lnoprzyjƒôtƒÖ skalƒô warto≈õci:

|                    |                                        |
|:------------------:|:--------------------------------------:|
|    **Warto≈õƒá**     |           **Interpretacja**            |
|    $V \leq 0.1$    |  Zmienna A ma ma≈Çy wp≈Çyw na zmiennƒÖ B  |
| $0.1 < V \leq 0.3$ | Zmienna A ma ≈õredni wp≈Çyw na zmiennƒÖ B |
|    $V \ge  0.5$    | Zmienna A ma silny wp≈Çyw na zmiennƒÖ B  |

gdzie $V$ jest warto≈õciƒÖ miary V-Cramera.

ZwiƒÖzki pomiƒôdzy zmiennymi kategorycznymi - choƒá istniejƒÖ - sƒÖ s≈Çabe.

### Pomiƒôdzy zmiennymi numerycznymi

```{r include = FALSE}
data_numeric <- data %>% 
  select(Age, Hours_Worked_Per_Week,Number_of_Virtual_Meetings)
str(data_numeric)
```

```{r}
library(GGally)
ggpairs(data_numeric, aes(color = "#FF7F24",alpha = 0.5), 
  upper = list(continuous = "points"), # Scatterploty w g√≥rnej czƒô≈õci
  lower = list(continuous = "points"), # Scatterploty w dolnej czƒô≈õci
  diag = list(continuous = "blankDiag"))
```

```{r echo=TRUE,include = FALSE}
library(knitr)
library(kableExtra)
```

```{r}
# Obliczanie korelacji Pearsona
correlation_matrix <- cor(data_numeric, method = "pearson")

# Wy≈õwietlenie macierzy korelacji w ≈Çadnym formacie
# Tworzenie tabeli
kable(correlation_matrix, digits = 2, format = "html") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
```

\
Po obliczeniu wsp√≥≈Çczynnika korelacji Pearsona widaƒá, ≈ºe wystƒôpuje tutaj brak jakichkolwiek zale≈ºno≈õci, na co wskazujƒÖ zerowe warto≈õci p-value dla poszczeg√≥lnych zmiennych.

### Pomiƒôdzy zmiennymi kategorycznymi i numerycznymi

Do zbdania zale≈ºno≈õci pomiƒôdzy tytu≈Çowymi zmiennymi wykorzystamy test Kruskal-Wallis, poniewa≈º jest on nieparametryczny i nie wymaga spe≈Çnienia za≈Ço≈ºe≈Ñ normalno≈õci rozk≈Çadu. Testy dla poszczeg√≥lnych zmiennych przeprowadzimy w podobny spos√≥b jak wcze≈õniej:

```{r}
data_categorical <- data_categorical %>%
  mutate_all(as.factor)

# Inicjalizacja macierzy
p_value_matrix <- matrix(NA, nrow = ncol(data_numeric), ncol = ncol(data_categorical))
rownames(p_value_matrix) <- colnames(data_numeric)
colnames(p_value_matrix) <- colnames(data_categorical)

# Pƒôtla przez zmienne
for (num_var in colnames(data_numeric)) {
  for (cat_var in colnames(data_categorical)) {
    # Przeprowadzenie testu Kruskal-Wallis
    test_result <- kruskal.test(as.formula(paste(num_var, "~", cat_var)), data = data)
    
    # Zapisanie p-value w macierzy
    p_value_matrix[num_var, cat_var] <- test_result$p.value
  }
}
```

Teraz zwizualizujemy uzyskane wyniki za pomocƒÖ interaktynego heatmap'u:

```{r}
# Tworzenie interaktywnej heatmapy z ulepszonƒÖ estetykƒÖ
plot_ly(
  z = p_value_matrix,
  x = colnames(p_value_matrix),
  y = rownames(p_value_matrix),
  type = "heatmap",
  colorscale = list(
    list(0, "#00008B"),       # Niskie p-value w kolorze niebieskim
    list(0.05, "#8968CD"),   # Granica istotno≈õci statystycznej w kolorze zielonym
    list(1, "#FFFF00")       # Wysokie p-value w kolorze bia≈Çym
  ),
  colorbar = list(
    title = "P-value",           # Tytu≈Ç paska kolor√≥w
    tickvals = c(0, 0.05, 1),    # G≈Ç√≥wne warto≈õci
    ticktext = c("0", "0.05", "1")  # Opisy warto≈õci
  ),
  hoverinfo = "x+y+z"           # Informacje wy≈õwietlane po najechaniu myszkƒÖ
) %>%
  layout(
    title = list(
      text = "P-value z test√≥w Kruskal-Wallis",  # Tytu≈Ç wykresu
      font = list(size = 20, color = "#333333")
    ),
    xaxis = list(
      title = "Zmienne kategoryczne",
      tickangle = -45,                # Rotacja etykiet osi X
      tickfont = list(size = 9)   # Wielko≈õƒá czcionki
    ),
    yaxis = list(
      title = "Zmienne numeryczne",
      tickfont = list(size = 9),
      margin(l = 100)     # Wielko≈õƒá czcionki
    ),
    margin = list(
      l = 100,  # Lewy margines (dla d≈Çugich nazw osi Y)
      r = 50,   # Prawy margines
      b = 100,  # Dolny margines
      t = 50    # G√≥rny margines
    )
  )
```

Jak widaƒá - brak jakichkolwiek zale≈ºno≈õci.

## Poziom samopoczucia w zale≈ºno≈õci od trybu pracy

```{r include = FALSE}
library(highcharter)
```

Zbadamy r√≥≈ºnice w poziomie stresu, izolacji spo≈Çecznej i r√≥wnowagi praca-≈ºycie miƒôdzy r√≥≈ºnymi lokalizacjami pracy:

```{r}
# Grupowanie i liczenie liczby wystƒÖpie≈Ñ
stress_data <- data %>%
  group_by(Work_Location, Stress_Level) %>%
  summarise(Count = n(), .groups = "drop")

# Obliczanie sumy dla ka≈ºdego poziomu stresu
stress_totals <- stress_data %>%
  group_by(Stress_Level) %>%
  summarise(Total = sum(Count))

stress_data %>% 
  hchart(
    'bar', hcaes(x = 'Stress_Level', y = 'Count', group = 'Work_Location'),  # Zmieniamy na 'bar'
    stacking = "normal"  # Zachowanie uk≈Çadu z wype≈Çnieniem wed≈Çug grupy
  ) %>%
  hc_colors(c("#00FF7F", "#4876FF", "#EE7942")) %>%
  hc_add_series(
    data = stress_totals,
    type = "scatter",
    hcaes(x = Stress_Level, y = Total),
    marker = list(
      enabled = FALSE,  # W≈ÇƒÖczenie punkt√≥w na g√≥rze s≈Çupk√≥w
      symbol = "circle",
      radius = 5
    ),
    dataLabels = list(
      enabled = TRUE,
      format = "{point.y}",  # Suma ca≈Çkowita
      style = list(
        fontSize = "14px",
        fontWeight = "bold",
        color = "black"
      )
    ),
    showInLegend = FALSE,
    name = "Og√≥lna liczba ocen"
  ) %>% 
  hc_xAxis(title = list(text = "Poziom stresu")) %>%  # Zmieniamy tytu≈Ç osi X na "Liczba ocen"
  hc_yAxis(
    title = list(text = "Liczba ocen"),  # Zmieniamy tytu≈Ç osi Y na "Poziom stresu"
    labels = list(format = "{value}")  # Formatowanie etykiet na osi Y
  ) %>% 
  hc_title(text = "Liczba ocen poziomu stresu wed≈Çug lokalizacji pracy")

```

Z wykresu widaƒá, ≈ºe poziom stresu u poszczeg√≥lnych grup jest roz≈Ço≈ºony r√≥wnomiernie, co wskazuje na brak zale≈ºno≈õci poziomu stresu od trybu wykonywanej pracy.

```{r}
workLife_balance_data <- data %>%
  group_by(Work_Location, Work_Life_Balance_Rating) %>%
  summarise(Count = n(), .groups = "drop")
# Obliczanie sumy dla ka≈ºdego poziomu stresu
WLB_totals <- workLife_balance_data %>%
  group_by(Work_Life_Balance_Rating) %>%
  summarise(Total = sum(Count))

workLife_balance_data %>% 
  hchart(
    'column', hcaes(x = 'Work_Life_Balance_Rating', y = 'Count', group = 'Work_Location'),
    stacking = "normal"
    ) %>%
  hc_colors(c("#00FF7F", "#4876FF","#EE7942")) %>% 
   hc_add_series(
    data = WLB_totals,
    type = "scatter",
    hcaes(x = Work_Life_Balance_Rating, y = Total),
    marker = list(
      enabled = FALSE,  # W≈ÇƒÖczenie punkt√≥w na g√≥rze s≈Çupk√≥w
      symbol = "circle",
      radius = 5
    ),
    dataLabels = list(
      enabled = TRUE,
      format = "{point.y}",  # Suma ca≈Çkowita
      style = list(
        fontSize = "14px",
        fontWeight = "bold",
        color = "black"
      )
    ),
    showInLegend = FALSE,
    name = "Og√≥lna liczba ocen"
  ) %>% 
  hc_xAxis(title = list(text = "Ocena work-life balance")) %>%
  hc_yAxis(title = list(text = "Liczba ocen")) %>% 
  hc_title(text = "Liczba ocen poziomu bilansu ≈ºycia wed≈Çug lokalizacji pracy")
```

Sytuacja wyglƒÖda podobnie jak poprzednio. Nie ma du≈ºego rozrzutu pomiƒôdzy ocenami bilansu ≈ºycie-praca w≈õr√≥d poszczeg√≥lnych grup. Nie ma tak, ≈ºe kt√≥ra≈õ grupa czuje wiƒôkszy bilans w swoim ≈ºyciu. Zatem nie zale≈ºy on od trybu wykonywanej pracy.

```{r}
socialIsolation_data <- data %>%
  group_by(Work_Location, Social_Isolation_Rating) %>%
  summarise(Count = n(), .groups = "drop")

SIR_totals <- socialIsolation_data %>%
  group_by(Social_Isolation_Rating) %>%
  summarise(Total = sum(Count))

socialIsolation_data <- socialIsolation_data %>% 
  left_join(SIR_totals, by = "Social_Isolation_Rating") %>%
  # proporcje
  mutate(Proportion = (Count / Total)*100)


socialIsolation_data %>% 
  hchart(
    'column', hcaes(x = 'Social_Isolation_Rating', y = 'Proportion', group = 'Work_Location'),
    stacking = "normal"
  ) %>%
  hc_colors(c("#00FF7F", "#4876FF","#EE7942")) %>% 
  hc_add_series(
    data = socialIsolation_data,
    type = "scatter",
    hcaes(x = Social_Isolation_Rating, y = Total),
    marker = list(
      enabled = FALSE,  # W≈ÇƒÖczenie punkt√≥w na g√≥rze s≈Çupk√≥w
      symbol = "circle",
      radius = 5
    ),
    dataLabels = list(
      enabled = TRUE,
      format = "{point.y:.2f}",  # proporcja z dwoma miejscami po przecinku
      style = list(
        fontSize = "14px",
        fontWeight = "bold",
        color = "black"
      )
    ),
    showInLegend = FALSE,
    name = "Og√≥lna proporcja ocen"
  ) %>% 
  hc_xAxis(title = list(text = "Ocena izolacji spo≈Çecznej")) %>%
  hc_yAxis(
    title = list(text = "Proporcja ocen"),
    min = 0,  # Ustawienie minimalnej warto≈õci osi Y
    max = 100,
    labels = list(format = "{value}%")  # Dodanie znaku % do etykiet na osi Y
  ) %>% 
  hc_tooltip(
    pointFormat = '<b>{point.y:,.2f}%</b>'
  ) %>%
  hc_title(text = "Proporcje ocen poziomu izolacji spo≈Çecznej wg lokalizacji pracy")

```

Tutaj proporcje r√≥wnie≈º sƒÖ podobne. Na ich podstawie mo≈ºemy stwierdziƒá, ≈ºe poziom izolacji spo≈Çecznej nie zale≈ºy od lokalizacji wykonywanej pracy.

## Wp≈Çyw aktywno≈õci fizycznej na poziom stresu i jako≈õƒá snu

Uwzglƒôdniamy tutaj r√≥wnie≈º tryb wykonywanej pracy:

```{r}
library(networkD3)
# Tworzymy dane przep≈Çywu (links) uwzglƒôdniajƒÖc Work_Location
sankey_data <- data %>%
  count(Work_Location, Physical_Activity, Sleep_Quality, Stress_Level) %>%
  rename(Count = n)

# Konwertujemy wszystkie zmienne na character, aby zapewniƒá sp√≥jno≈õƒá typ√≥w
sankey_data$Work_Location <- as.character(sankey_data$Work_Location)
sankey_data$Physical_Activity <- as.character(sankey_data$Physical_Activity)
sankey_data$Sleep_Quality <- as.character(sankey_data$Sleep_Quality)
sankey_data$Stress_Level <- as.character(sankey_data$Stress_Level)

# Unikalne wƒôz≈Çy (nodes), teraz uwzglƒôdniamy r√≥wnie≈º Work_Location
nodes <- data.frame(name = unique(c(
  sankey_data$Work_Location,  # Dodajemy Work_Location jako pierwszy wƒôze≈Ç
  sankey_data$Physical_Activity,
  sankey_data$Sleep_Quality,
  sankey_data$Stress_Level
)))

# Tworzymy indeksy dla wƒôz≈Ç√≥w (konwersja nazw na indeksy)
sankey_links <- sankey_data %>%
  mutate(
    source = match(Work_Location, nodes$name) - 1,  # Zmieniamy na Work_Location jako ≈∫r√≥d≈Ço
    target1 = match(Physical_Activity, nodes$name) - 1,
    target2 = match(Sleep_Quality, nodes$name) - 1,
    target3 = match(Stress_Level, nodes$name) - 1
  )

# Pierwsze po≈ÇƒÖczenie: Work_Location -> Physical_Activity
links1 <- sankey_links %>%
  select(source, target = target1, value = Count)

# Drugie po≈ÇƒÖczenie: Physical_Activity -> Sleep_Quality
links2 <- sankey_links %>%
  select(source = target1, target = target2, value = Count)

# Trzecie po≈ÇƒÖczenie: Sleep_Quality -> Stress_Level
links3 <- sankey_links %>%
  select(source = target2, target = target3, value = Count)

# ≈ÅƒÖczymy przep≈Çywy
links <- bind_rows(links1, links2, links3)

# Okre≈õlenie kolor√≥w dla grup (np. dla poziom√≥w stresu)
my_color <- 'd3.scaleOrdinal() .domain(["Low", "Medium", "High"]) .range(["#69b3a2", "steelblue", "red"])'

# Tworzenie wykresu Sankey z dodanym pierwszym s≈Çupkiem Work_Location
sankeyNetwork(
  Links = links,
  Nodes = nodes,
  Source = "source",
  Target = "target",
  Value = "value",
  NodeID = "name",
  units = "Respondents",
  fontSize = 12,
  nodeWidth = 30
)
```

Szeroko≈õci link√≥w (zaznaczonych kolorem szarym, ≈ÇƒÖczƒÖce poszczeg√≥lne kategorie danych) sƒÖ podobne. Ponadto ich rozk≈Çad jest prawie identyczny. Wskazuje to na to, ≈ºe nie tryb wykonywanej pracy nie jest powiƒÖzany z poziomem aktywno≈õci fizycznej, a co za tym idzie lokalizacja pracy i poziom aktywno≈õci fizycznej nie majƒÖ wp≈Çywu na poziom stresu czy snu u pracownik√≥w.

## Wsp√≥≈Çczynnik zdrowia psychicznego (MHI)

MHI to autorski wska≈∫nik, kt√≥ry pomo≈ºe bli≈ºej przyjerzeƒá siƒô problemowi i pro≈õciej przeanalizowaƒá dane, kt√≥re w wiƒôkszo≈õci sƒÖ kategoryczne. MHI przyjmuje warto≈õci z zakresu \[0,1\]. Im bli≈ºej jest jedynki, tym lepiej czuje siƒô dana osoba wzglƒôdem zdrowia psychicznego.\
MHI zosta≈Ç obliczony na podstawie zmiennych takich jak:

-   `Mental_Health_Condition` - poniewa≈º choroby psychiczne majƒÖ bezpo≈õredni wp≈Çyw na zdrowie psychiczne,

-   `Stress_Level` - poziom stresu wp≈Çywa na nasze samopoczucie,

-   `Social_Isolation_Rating` - brak interakcji z innymi sprawia, ≈ºe czujemy siƒô gorzej,

-   `Work_Life_Balance_Rating` - im trudniej nam jest zbilansowaƒá ≈ºycie, tym gorzej siƒô czujemy,

-   i `Physical_Activity` - czujemy siƒô lepiej, gdy ƒáwiczymy.

Poszczeg√≥lnym kategoriom powy≈ºszych zmiennych nadano odpowiednie wagi od 0 do 1 z poszczeg√≥lnymi odstƒôpami. Dodatkowo przy zmiennych `Social_Isolation_Rating` i `Work_Life_Balance_Rating` przeskalowano warto≈õci, aby dopasowaƒá je do dalszych oblicze≈Ñ.

```{r include = TRUE}
# Mapowanie warto≈õci zmiennych i skalowanie
data <- data %>%
  mutate(
    # Sk≈Çadowe wska≈∫nika
    Mental_Health_Condition_Score = case_when(
      Mental_Health_Condition == "None" ~ 1,
      Mental_Health_Condition == "Anxiety" ~ 0.75,
      Mental_Health_Condition == "Burnout" ~ 0.5,
      Mental_Health_Condition == "Depression" ~ 0.25,
      TRUE ~ NA_real_
    ),
    Stress_Level_Score = case_when(
      Stress_Level == "Low" ~ 1,
      Stress_Level == "Medium" ~ 0.5,
      Stress_Level == "High" ~ 0,
      TRUE ~ NA_real_
    ),
    Social_Isolation_Score = (as.numeric(Social_Isolation_Rating) - 1) / 4, # Skalowanie 1-5 do 0-1
    Work_Life_Balance_Score = (as.numeric(Work_Life_Balance_Rating) - 1) / 4, # Skalowanie 1-5 do 0-1
    Physical_Activity_Score = case_when(
      Physical_Activity == "None" ~ 0,
      Physical_Activity == "Weekly" ~ 0.5,
      Physical_Activity == "Daily" ~ 1,
      TRUE ~ NA_real_
    )
  )

# Obliczanie wsp√≥≈Çczynnika zdrowia psychicznego
data <- data %>%
  mutate(
    Mental_Health_Index = (
      Mental_Health_Condition_Score + 
      Physical_Activity_Score +
      (1 - Social_Isolation_Score) + # Im mniejsza izolacja, tym lepszy wynik
      Work_Life_Balance_Score +
      Stress_Level_Score
    ) / 5 # ≈örednia z 5 komponent√≥w
  )
```

### Rozk≈Çad MHI dla ca≈Çego zbioru danych

```{r}
median_MHI_value <- median(data$Mental_Health_Index, na.rm = TRUE)
histogram_chart <- data %>%
  ggplot(aes(x = Mental_Health_Index)) +
  geom_histogram(binwidth = 0.05, fill = "#FF6347", color = "white", alpha = 0.70) +
  labs(
    title = "Rozk≈Çad wska≈∫nika zdrowia psychicznego",
    x = "Wska≈∫nik zdrowia psychicznego",
    y = "Liczba os√≥b"
  ) + 
  scale_x_continuous(breaks = seq(0.0, 1, by = 0.1))+
  geom_vline(aes(xintercept = median_MHI_value), color = "black", linetype = "dashed", size = 1)+
  theme_minimal()

histogram_chart <- ggplotly(histogram_chart)
histogram_chart
```

Rozk≈Çad warto≈õci wska≈∫nika w badanym zbiorze danych jest zbli≈ºony do rozk≈Çadu normalnego z medianƒÖ 0,5. Dostajemy stƒÖd, ≈ºe po≈Çowa obserwacji czuje siƒô gorzej ni≈º ≈õrednio, a po≈Çowa - lepiej.

```{r}
boxplot_chart <- data %>%
  ggplot(aes(x = Work_Location, y = Mental_Health_Index, fill = Work_Location)) +
  geom_boxplot() +
  labs(
    title = "Rozk≈Çad wska≈∫nika zdrowia psychicznego wed≈Çug lokalizacji pracy",
    x = "Lokalizacja pracy",
    y = "MHI"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("#00FF7F", "#4876FF", "#EE7942"))

boxplot_chart <- ggplotly(boxplot_chart)
boxplot_chart
```

Widaƒá, ≈ºe warto≈õci MHI niezbyt siƒô r√≥≈ºniƒÖ w zale≈ºno≈õci od lokalizacji pracy. Nieco wyr√≥≈ºniajƒÖ siƒô nim jedynie pracownicy zdalni, ale przedstawiona r√≥≈ºnica w poziomie zdrowia psychicznego nie jest znaczƒÖca. M√≥wi nam to, ≈ºe samopoczucie danej osoby nie zale≈ºy od lokalizacji pracy. Tym samym, osoby pracujƒÖce zdalnie, nie czujƒÖ siƒô zdecydowanie gorzej czy lepiej od wszystkich pozosta≈Çych.

## PowiƒÖzania MHI z poszczeg√≥lnymi zmiennymi

### 1. Czy z≈Çe samopoczucie psychiczne w zwiƒÖzku z wykonywanƒÖ pracƒÖ zdalnƒÖ zale≈ºy od rodzaju wykonywanego zawodu lub wieku pracownika?

```{r}
data1 <- data.frame(
  id=seq(1,60),
  individual=paste( "Mister ", seq(1,60), sep=""),
  value=sample( seq(10,100), 60, replace=T)
)

job_distribution <- data %>%
  count(Job_Role) %>%
  arrange(desc(n)) %>% 
  mutate(id=seq(1,7))
 
# ----- ramka danych dla labels ---- #
# imie i pozycja ka≈ºdego labela
label_data <- job_distribution
 
# kƒÖt label√≥w
number_of_bar <- nrow(label_data)
angle <-  90 - 360 * (label_data$id-0.5) /number_of_bar
 
# obliczamy przyr√≥wnanie labela (lewe czy prawe)
label_data$hjust<-ifelse( angle < -90, 1, 0)
 
label_data$angle<-ifelse(angle < -90, angle+180, angle)
# ----- ------------------------------------------- ---- #
 
 
p <- ggplot(job_distribution, aes(x=as.factor(id), y=n, fill = Job_Role)) +       
  geom_bar(stat="identity") +
  
  # Granice wykresu: warto≈õci ujemne dla wewnƒôtrznego okrƒôgu
   ylim(-max(job_distribution$n)*0.3, max(job_distribution$n) + 80)  +
  
  theme_minimal() +
  theme(
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    plot.margin = unit(rep(-1,4), "cm")
  ) +
  
  # zmiana systemu wsp√≥≈Çrzƒôdnych
  coord_polar(start = 0) +
  
  # dodajemy labely
  geom_text(data=label_data, aes(x=id, y=n+10, label=Job_Role, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.5, angle= label_data$angle, inherit.aes = FALSE ) 
 
p
```

Wykres wskazuje, ≈ºe rozk≈Çad zawod√≥w w zbiorze danych jest r√≥wnomierny (\*\*co z tego wynika?\*\*)

```{r}
heatmap_AgeHMI_data <- data %>%
  mutate(Age_Group = cut(Age, 
                         breaks = c(-Inf, 20, 30, 40, 50,60, Inf), 
                         labels = c("Mniej ni≈º 20", "20‚Äì30", "30‚Äì40", "40‚Äì50","50-60", "60+"))) %>%
  group_by(Job_Role, Age_Group) %>%
  summarise(Average_Mental_Health = mean(Mental_Health_Index, na.rm = TRUE))

heatmap <- ggplot(heatmap_AgeHMI_data, aes(x = Job_Role, y = Age_Group, fill = Average_Mental_Health)) +
  geom_tile() +
  labs(title = "Wp≈Çyw zawodu i wieku na zdrowie psychiczne", 
       x = "Zaw√≥d", 
       y = "Grupa wiekowa",
       fill = "Wska≈∫nik MHI") +
  scale_fill_gradient(low = "red", high = "green") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Rotacja napis√≥w na osi X

interactive_heatmap <- ggplotly(heatmap)

interactive_heatmap
```

Warto zwr√≥ciƒá uwagƒô na to, ≈ºe maksymalny wiek w zbiorze danych to 60, a minimalny to 22 lata. R√≥≈ºnice w warto≈õciach MHI dla poszczeg√≥lnych zawod√≥w i grup wiekowych sƒÖ minimalne, co wskazuje na to, ≈ºe poziom zdrowia psychicznego nie zale≈ºy od grupy wiekowej i zawodu.

```{r}
ridgeline_AgeHMI_data <- data %>%
  select(Job_Role, Age, Mental_Health_Index) %>% 
  mutate(Age_Group = cut(Age, 
                         breaks = c(-Inf, 20, 30, 40, 50,60, Inf), 
                         labels = c("Mniej ni≈º 20", "20‚Äì30", "30‚Äì40", "40‚Äì50","50-60", "60+"))) 

library(ggridges)
ggplot(ridgeline_AgeHMI_data, aes(x = Mental_Health_Index, y = Job_Role, fill = Job_Role)) +
  geom_density_ridges(alpha = 0.5, scale = 0.8) +
  theme_ridges() +
  labs(title = "Ridgeline Chart dla MHI",
       x = "",
       y = "")+
  theme(legend.position = "none")
```

Widaƒá r√≥wnie≈º brak znaczƒÖcych r√≥≈ºnic warto≈õci wska≈∫nika MHI dla kt√≥regokolwiek z przedstawionych zawod√≥w, czyli nie jest tak, ≈ºe przedstawiciele kt√≥rego≈õ zawodu czujƒÖ siƒô znacznie gorzej/lepiej ni≈º inni.

### 2. Jakie sƒÖ r√≥≈ºnice w samopoczuciu psychicznym pracownik√≥w zdalnych w zale≈ºno≈õci od ich p≈Çci?

```{r}
ggplot(data %>% 
         filter(Work_Location == "Remote", 
                Mental_Health_Index >= 0, 
                Mental_Health_Index <= 1), 
       aes(x = Gender, y = Mental_Health_Index, fill = Gender)) +
  geom_violin(trim = FALSE, alpha = 0.6) +
  geom_boxplot(width = 0.4, outlier.shape = NA) +
  ylab("MHI") +
  xlab("P≈Çeƒá") +
  ggtitle("Samopoczucie wg p≈Çci") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")

```

R√≥wnie≈º bardzo zbli≈ºone wyniki otrzymujemy odwzorowujƒÖc MHI w zale≈ºno≈õci od p≈Çci. Wyniki sƒÖ takie same jak poprzednio: brak znaczƒÖcych r√≥≈ºnic. Mo≈ºemy jedynie zauwa≈ºyƒá, ≈ºe z tych, kto wskaza≈Ç swojƒÖ p≈Çeƒá jako "Prefer not to say", wiƒôkszo≈õƒá czuje siƒô dobrze. Natomiast dla os√≥b, kt√≥re zaznaczy≈Çy "Non-binary", widzimy rozk≈Çad zbli≈ºony do bimodalnego. Oznacza to, ≈ºe istniejƒÖ w tym przypadku dwie osobne grupy: osoby non-binary, kt√≥re dobrze siƒô czujƒÖ, i te osoby non-binary, kt√≥re czujƒÖ siƒô ≈∫le ze wzglƒôdu na zdrowie psychiczne.

### 3. Czy og√≥lny stan psychiczny pracownik√≥w stacjonarnych, hybrydowych oraz zdalnych r√≥≈ºni siƒô w zale≈ºno≈õci od zamieszkiwanego kontynentu?

```{r}
library(ggplot2)
library(ggiraph)
library(dplyr)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(patchwork)

# Wczytanie danych geograficznych
world_sf <- ne_countries(scale = "medium", returnclass = "sf")

# Filtracja: usuwamy Antarktydƒô
world_sf <- world_sf %>%
  filter(continent != "Antarctica")

# Naprawa geometrii, aby obs≈Çugiwaƒá linie daty
world_sf <- st_make_valid(world_sf)
world_sf <- st_wrap_dateline(world_sf, options = c("WRAPDATELINE=YES"))

# Grupowanie danych na poziomie kontynent√≥w
continent_sf <- world_sf %>%
  group_by(continent) %>%
  summarise(geometry = st_union(geometry)) %>%  # ≈ÅƒÖczenie geometrii kraj√≥w w jeden obiekt dla kontynentu
  rename(Region = continent)

# Przekszta≈Çcenie uk≈Çadu wsp√≥≈Çrzƒôdnych na odpowiedni (np. EPSG:3857)
continent_sf <- st_transform(continent_sf, crs = 3857)

# Dane ze wska≈∫nikiem zdrowia psychicznego
map_data <- data %>%
  group_by(Region) %>%
  summarise(Mental_Health_Index = mean(Mental_Health_Index, na.rm = TRUE))

# ≈ÅƒÖczenie danych geograficznych z map_data
continent_data <- continent_sf %>%
  left_join(map_data, by = "Region")

# Barplot z kontynentami
barplot <- ggplot(continent_data, aes(
  x = reorder(Region, Mental_Health_Index),
  y = Mental_Health_Index,
  tooltip = Region,
  data_id = Region,
  fill = Mental_Health_Index
)) +
  geom_col_interactive() +
  scale_fill_gradient(low = "red", high = "green", name = "MHI") +
  coord_flip() +
  theme_minimal() +
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    plot.margin = margin(5, 5, 5, 5),
    axis.text = element_text(size = 8),
    legend.position = "none"
  ) +
  labs(title = "≈öredni wska≈∫nik zdrowia psychicznego wg kontynent√≥w")

# Mapa z kontynentami
map <- ggplot() +
  geom_sf_interactive(
    data = continent_data,
    aes(fill = Mental_Health_Index, tooltip = Region, data_id = Region)
  ) +
  scale_fill_gradient(low = "red", high = "green", name = "MHI") +
  coord_sf(crs = st_crs(3857)) +
  theme_void() +
  theme(legend.position = "right") +
  labs(title = "Mapa wska≈∫nika zdrowia psychicznego")

# Po≈ÇƒÖczenie barplotu i mapy w jednym uk≈Çadzie
combined_plot <- (barplot) / (map) + plot_layout(heights = c(0.8, 2))

interactive_plot <- girafe(
  ggobj = combined_plot,
  width_svg = 10,
  height_svg = 6
)

interactive_plot <- girafe_options(
  interactive_plot,
  opts_hover(css = "stroke:black;stroke-width:2px;"),
  opts_tooltip(css = "background:white;color:black;padding:5px;border-radius:10px;")
)

interactive_plot

```

Najwy≈ºszy (ale nie znaczƒÖco, poniewa≈º odbiega od najni≈ºszego jedynie o 0.008 jednostek) wystƒôpuje w Azji. Oznacza to, ≈ºe w przeprowadzonej ankiecie najwy≈ºsze wyniki MHI uzyska≈Çy pracownicy w≈Ça≈õnie stamtƒÖd. Og√≥lny poziom zdrowia psychicznego na ≈õwiecie, w≈õr√≥d zbadanych pracownik√≥w, jest ≈õredni. Warto≈õci MHI nie sƒÖ zdominowane przez bardzo niskie albo bardzo wysokie wyniki. Przeciƒôtna osoba ma umiarkowany poziom zdrowia psychicznego - ani bardzo dobry, ani bardzo z≈Çy.

### 4. Czy wp≈Çyw pracy hybrydowej jest mniej szkodliwy dla zdrowia psychicznego cz≈Çowieka ni≈º wp≈Çyw pracy zdalnej?

```{r}
ggplot(data %>% 
         filter(Work_Location %in% c("Hybrid", "Remote"), 
                Mental_Health_Index >= 0, 
                Mental_Health_Index <= 1), 
       aes(x = Work_Location, y = Mental_Health_Index, fill = Work_Location)) +
  geom_violin(trim = FALSE, alpha = 0.6) +
  geom_boxplot(width = 0.4, outlier.shape = NA) +
  ylab("MHI") +
  xlab("Lokalizacja pracy") +
  ggtitle("Hybrid Vs Remote MHI") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")
```

Rozk≈Çad wska≈∫nika MHI dla pracownik√≥w zdalnych jest zbli≈ºony do rozk≈Çadu bimodalnego. Jego wiƒôksza sko≈õno≈õƒá w prawƒÖ stronƒô wskazuje na to, ≈ºe wystƒôpuje przewaga os√≥b z lepszym samopoczuciem psychicznym ze zdalnƒÖ lokalizacjƒÖ pracy. Potwierdza to r√≥wnie≈º mediana, kt√≥rƒÖ mo≈ºemy por√≥wnaƒá do tej wystƒôpujƒÖcej u pracownik√≥w hybrydowych. Wnioskujemy, ≈ºe praca zdalna wiƒÖ≈ºe siƒô z lepszym samopoczuciem psychicznym ni≈º praca hybrydowa.

### 5. Czy tryb wykonywanej pracy mo≈ºe mieƒá wp≈Çyw na jako≈õƒá snu pracownik√≥w?

```{r}
data_summary <- data %>%
  count(Sleep_Quality, Work_Location)

interactive_sleep_chart <- hchart(data_summary, 
                                  "column", 
                                  hcaes(x = Sleep_Quality, y = n, group = Work_Location)) %>%
  hc_title(text = "Jako≈õƒá snu wg trybu pracy") %>%
  hc_xAxis(title = list(text = "Jako≈õƒá snu")) %>%
  hc_yAxis(title = list(text = "Liczba os√≥b")) %>%
  hc_plotOptions(
    column = list(
      borderWidth = 0,
      groupPadding = 0.1  # Odstƒôpy miƒôdzy grupami
    )
  ) %>%
  hc_colors(c("#B23AEE", "#EE7621","#00EEEE")) 

interactive_sleep_chart
```

Nie wystƒôpuje tutaj wyra≈∫ny wp≈Çyw trybu pracy na jako≈õƒá snu pracownik√≥w. Nie mo≈ºemy wyciƒÖgnƒÖƒá jednoznacznych wniosk√≥w.

### 6. W jakim stopniu wsparcie oferowane przez pracodawcƒô zmniejsza negatywne skutki pracy zdalnej?

```{r}
# Wykres s≈Çupkowy z podzia≈Çem na Work_Location
support_barplot_location <- ggplot(data %>% filter(Work_Location=="Remote"), aes(x = as.factor(Company_Support_for_Remote_Work), y = Mental_Health_Index, fill = Company_Support_for_Remote_Work)) +
  stat_summary(fun = "mean", geom = "bar", position = "dodge", alpha = 0.8) +
  labs(title = "≈öredni poziom zdrowia psychicznego wg wsparcia pracodawcy i trybu pracy", 
       x = "Wsparcie pracodawcy", 
       y = "≈öredni poziom zdrowia psychicznego (MHI)") +
  scale_x_discrete(labels = c("Bardzo niskie", "Niskie", "≈örednie", "Wysokie", "Bardzo wysokie")) +
  theme_minimal() +
  theme(legend.position = "none")

support_barplot_location

```

Jak widaƒá, wsp√≥≈Çczynnik zdrowia psychicznego jest taki sam dla r√≥≈ºnych poziom√≥w wsparcia oferowanych przez pracodawcƒô. Poszczeg√≥lne poziomy wsparcia nie r√≥≈ºnicujƒÖ grupy pracownik√≥w zdalnych pod kƒÖtem zdrowia psychicznego.

### 7. Czy liczba przepracowanych godzin tygodniowo ma znaczenie w kontek≈õcie zdrowia psychicznego w pracy zdalnej?

```{r}
hours_chart <- ggplot(data %>% filter(Work_Location == "Remote"), aes(x = Hours_Worked_Per_Week, y = Mental_Health_Index)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", col = "blue") +
  labs(title = "Wp≈Çyw liczby godzin na zdrowie psychiczne", x = "Godziny pracy tygodniowo", y = "Zdrowie psychiczne (MHI)") +
  theme_minimal()

hours_chart
```

Liczba przepracowanych godzin tygodniowo nie wp≈Çywa w istotny spos√≥b na poziom zdrowia psychicznego. ≈öredni poziom zdrowia psychicznego jest sta≈Çy i nie zale≈ºy od liczby godzin pracy.

# Podsumowanie

Przeprowadzone analizy wskazujƒÖ, ≈ºe tryb wykonywanej pracy (zdalny, hybrydowy czy stacjonarny) nie ma istotnego wp≈Çywu na poziom zdrowia psychicznego pracownik√≥w, ich stres, jako≈õƒá snu ani poczucie izolacji spo≈Çecznej, co potwierdzajƒÖ zar√≥wno wska≈∫nik MHI, jak i brak znaczƒÖcych r√≥≈ºnic w wynikach miƒôdzy grupami. Wsparcie pracodawcy oraz liczba przepracowanych godzin r√≥wnie≈º nie r√≥≈ºnicowa≈Çy istotnie zdrowia psychicznego, a aktywno≈õƒá fizyczna nie by≈Ça powiƒÖzana z trybem pracy. Mimo ≈ºe pracownicy zdalni wykazywali nieznacznie wy≈ºsze warto≈õci MHI ni≈º hybrydowi, r√≥≈ºnice te by≈Çy niewielkie, co sugeruje, ≈ºe og√≥lny wp≈Çyw lokalizacji pracy na dobrostan psychiczny jest ograniczony. Wyniki wskazujƒÖ na potrzebƒô indywidualnego podej≈õcia do wsparcia pracownik√≥w niezale≈ºnie od trybu pracy.
